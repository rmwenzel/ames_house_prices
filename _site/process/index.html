<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Processing and cleaning &middot; Ames Housing Data
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/ames_house_prices/public/css/poole.css">
  <link rel="stylesheet" href="/ames_house_prices/public/css/syntax.css">
  <link rel="stylesheet" href="/ames_house_prices/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/ames_house_prices/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/ames_house_prices/public/favicon.ico">
  --->

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!--- KaTeX --->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
      onload="renderMathInElement(document.body);"></script>
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">

  <nav class="sidebar-nav">

    <a class="sidebar-nav-item active" href="/ames_house_prices/process/">Process</a>
    <a class="sidebar-nav-item" href="/ames_house_prices/explore/">Explore</a>
    <a class="sidebar-nav-item" href="/ames_house_prices/model/">Model</a>

  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2019.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/ames_house_prices/" title="Home">Ames Housing Data</a>
            <small>analysis and predictive modeling</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="page">
  <h1 class="page-title">Processing and cleaning</h1>
  	<p>The original dataset is available <a href="http://www.amstat.org/publications/jse/v19n3/decock/AmesHousing.xls">here</a>. A version of the dataset is available <a href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques">on Kaggle</a>. This is the dataset we’ll be working with.</p>

<p>First we’ll do preliminary processing and cleaning of the original dataset. Later we’ll <a href="/ames_house_prices/explore/">explore the cleaned data and select/engineer features</a> and <a href="/ames_house_prices/model">model and predict sale prices</a>.</p>

<h2>Contents<span class="tocSkip"></span></h2>
<div class="toc">
  <ul class="toc-item"><li><span><a href="#setup" data-toc-modified-id="Setup-1">Setup</a></span></li><li><span><a href="#load-and-inspect-data" data-toc-modified-id="Load-and-inspect-Data-2">Load and inspect Data</a></span><ul class="toc-item"><li><span><a href="#variable-descriptions" data-toc-modified-id="Variable-descriptions-2.1">Variable descriptions</a></span></li><li><span><a href="#load-into-dataframe" data-toc-modified-id="Load-into-DataFrame-2.2">Load into <code>DataFrame</code></a></span></li></ul></li><li><span><a href="#Clean-data" data-toc-modified-id="Clean-data-3">Clean data</a></span><ul class="toc-item"><li><span><a href="#classify-variables-by-kind" data-toc-modified-id="Classify-variables-by-kind-3.1">Classify variables by kind</a></span></li><li><span><a href="#encode-variables" data-toc-modified-id="Encode-variables-3.2">Encode variables</a></span></li><li><span><a href="#Drop-problematic-variables-and-observations" data-toc-modified-id="Drop-problematic-variables-and-observations-3.3">Drop problematic variables and observations</a></span></li><li><span><a href="#missing-values" data-toc-modified-id="Missing-Values-3.4">Missing Values</a></span><ul class="toc-item"><li><span><a href="#inspect-train-and-test-distributions-of-missing-values" data-toc-modified-id="Inspect-train-and-test-distributions-of-missing-values-3.4.1">Inspect train and test distributions of missing values</a></span></li><li><span><a href="#impute-small-numbers-of-missing-values-by-hand" data-toc-modified-id="Impute-small-numbers-of-missing-values-by-hand-3.4.2">Impute small numbers of missing values by hand</a></span></li><li><span><a href="#impute-missing-categorical-values-with-xgbclassifier" data-toc-modified-id="Impute-missing-categorical-values-with-XGBClassifier-3.4.3">Impute missing categorical values with <code>XGBClassifier</code></a></span></li><li><span><a href="#impute-missing-quantitative-values-with-mice-and-pmm" data-toc-modified-id="Impute-missing-quantitative-values-with-MICE-and-PMM-3.4.4">Impute missing quantitative values with MICE and PMM</a></span></li></ul></li><li><span><a href="#enforce-dtypes" data-toc-modified-id="Enforce-dtypes-3.5">Enforce dtypes</a></span></li></ul></li><li><span><a href="#save-processed-data" data-toc-modified-id="Save-processed-data-4">Save processed data</a></span></li></ul>
</div>

<h2 id="setup">Setup</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># standard imports</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">nan</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s">'ignore'</span><span class="p">)</span>
<span class="c"># add parent directory for importing custom classes</span>
<span class="n">pardir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pardir</span><span class="p">)</span>

<span class="c"># custom class for data description</span>
<span class="kn">from</span> <span class="nn">codes.process</span> <span class="kn">import</span> <span class="o">*</span>

</code></pre></div></div>

<h2 id="load-and-inspect-data">Load and inspect Data</h2>

<h3 id="variable-descriptions">Variable descriptions</h3>

<p>A description of the dataset variables is available in <code class="highlighter-rouge">data/data_description.txt</code>, but it requires a little bit of preprocessing. The custom augmented <code class="highlighter-rouge">dict</code> class <code class="highlighter-rouge">DataDescription</code> contains code to do this (see <code class="highlighter-rouge">house_prices/codes/preprocess.py</code>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">desc</span> <span class="o">=</span> <span class="n">DataDescription</span><span class="p">(</span><span class="s">'../data/data_description.txt'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First five variable names</span>
<span class="nb">list</span><span class="p">(</span><span class="n">desc</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['MSSubClass', 'MSZoning', 'LotFrontage', 'LotArea', 'Street']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># First variable description and values</span>
<span class="n">desc</span><span class="p">[</span><span class="s">'MSSubClass'</span><span class="p">]</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'Description': ' Identifies the type of dwelling involved in the sale.',
 'Values': {'20': '1-STORY 1946 &amp; NEWER ALL STYLES',
  '30': '1-STORY 1945 &amp; OLDER',
  '40': '1-STORY W/FINISHED ATTIC ALL AGES',
  '45': '1-1/2 STORY - UNFINISHED ALL AGES',
  '50': '1-1/2 STORY FINISHED ALL AGES',
  '60': '2-STORY 1946 &amp; NEWER',
  '70': '2-STORY 1945 &amp; OLDER',
  '75': '2-1/2 STORY ALL AGES',
  '80': 'SPLIT OR MULTI-LEVEL',
  '85': 'SPLIT FOYER',
  '90': 'DUPLEX - ALL STYLES AND AGES',
  '120': '1-STORY PUD (Planned Unit Development) - 1946 &amp; NEWER',
  '150': '1-1/2 STORY PUD - ALL AGES',
  '160': '2-STORY PUD - 1946 &amp; NEWER',
  '180': 'PUD - MULTILEVEL - INCL SPLIT LEV/FOYER',
  '190': '2 FAMILY CONVERSION - ALL STYLES AND AGES'}}
</code></pre></div></div>

<h3 id="load-into-dataframe">Load into <code class="highlighter-rouge">DataFrame</code></h3>

<p>We’ll combine training and test data into a single <code class="highlighter-rouge">DataFrame</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/train.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'Id'</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../data/test.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'Id'</span><span class="p">)</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">'train'</span><span class="p">,</span> <span class="s">'test'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">full</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
  <style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

  <table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>LotConfig</th>
      <th>...</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
    <tr>
      <th></th>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="5" valign="top">train</td>
      <td>1</td>
      <td>60</td>
      <td>RL</td>
      <td>65.0</td>
      <td>8450</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>208500.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>20</td>
      <td>RL</td>
      <td>80.0</td>
      <td>9600</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>181500.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>60</td>
      <td>RL</td>
      <td>68.0</td>
      <td>11250</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>223500.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>70</td>
      <td>RL</td>
      <td>60.0</td>
      <td>9550</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Corner</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>WD</td>
      <td>Abnorml</td>
      <td>140000.0</td>
    </tr>
    <tr>
      <td>5</td>
      <td>60</td>
      <td>RL</td>
      <td>84.0</td>
      <td>14260</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>250000.0</td>
    </tr>
  </tbody>
</table>
  <p>5 rows × 80 columns</p>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">full</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 2919 entries, (train, 1) to (test, 2919)
Data columns (total 80 columns):
MSSubClass       2919 non-null int64
MSZoning         2915 non-null object
LotFrontage      2433 non-null float64
LotArea          2919 non-null int64
Street           2919 non-null object
Alley            198 non-null object
LotShape         2919 non-null object
LandContour      2919 non-null object
Utilities        2917 non-null object
LotConfig        2919 non-null object
LandSlope        2919 non-null object
Neighborhood     2919 non-null object
Condition1       2919 non-null object
Condition2       2919 non-null object
BldgType         2919 non-null object
HouseStyle       2919 non-null object
OverallQual      2919 non-null int64
OverallCond      2919 non-null int64
YearBuilt        2919 non-null int64
YearRemodAdd     2919 non-null int64
RoofStyle        2919 non-null object
RoofMatl         2919 non-null object
Exterior1st      2918 non-null object
Exterior2nd      2918 non-null object
MasVnrType       2895 non-null object
MasVnrArea       2896 non-null float64
ExterQual        2919 non-null object
ExterCond        2919 non-null object
Foundation       2919 non-null object
BsmtQual         2838 non-null object
BsmtCond         2837 non-null object
BsmtExposure     2837 non-null object
BsmtFinType1     2840 non-null object
BsmtFinSF1       2918 non-null float64
BsmtFinType2     2839 non-null object
BsmtFinSF2       2918 non-null float64
BsmtUnfSF        2918 non-null float64
TotalBsmtSF      2918 non-null float64
Heating          2919 non-null object
HeatingQC        2919 non-null object
CentralAir       2919 non-null object
Electrical       2918 non-null object
1stFlrSF         2919 non-null int64
2ndFlrSF         2919 non-null int64
LowQualFinSF     2919 non-null int64
GrLivArea        2919 non-null int64
BsmtFullBath     2917 non-null float64
BsmtHalfBath     2917 non-null float64
FullBath         2919 non-null int64
HalfBath         2919 non-null int64
BedroomAbvGr     2919 non-null int64
KitchenAbvGr     2919 non-null int64
KitchenQual      2918 non-null object
TotRmsAbvGrd     2919 non-null int64
Functional       2917 non-null object
Fireplaces       2919 non-null int64
FireplaceQu      1499 non-null object
GarageType       2762 non-null object
GarageYrBlt      2760 non-null float64
GarageFinish     2760 non-null object
GarageCars       2918 non-null float64
GarageArea       2918 non-null float64
GarageQual       2760 non-null object
GarageCond       2760 non-null object
PavedDrive       2919 non-null object
WoodDeckSF       2919 non-null int64
OpenPorchSF      2919 non-null int64
EnclosedPorch    2919 non-null int64
3SsnPorch        2919 non-null int64
ScreenPorch      2919 non-null int64
PoolArea         2919 non-null int64
PoolQC           10 non-null object
Fence            571 non-null object
MiscFeature      105 non-null object
MiscVal          2919 non-null int64
MoSold           2919 non-null int64
YrSold           2919 non-null int64
SaleType         2918 non-null object
SaleCondition    2919 non-null object
SalePrice        1460 non-null float64
dtypes: float64(12), int64(25), object(43)
memory usage: 1.8+ MB
</code></pre></div></div>

<p>We can see some cleanup and preprocessing will be necessary. For example, there are quite a few missing values, and more than half the variables have been have been cast to <code class="highlighter-rouge">pandas</code> catch-all <code class="highlighter-rouge">object</code> dtype.</p>

<p>About half of the data is training data and half is testing data - observations from the testing data have <code class="highlighter-rouge">NaN</code> values for <code class="highlighter-rouge">SalePrice</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># shape of training data</span>
<span class="n">full</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'train'</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1460, 80)
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># shape of training data</span>
<span class="n">full</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'test'</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1459, 80)
</code></pre></div></div>

<h2 id="clean-data">Clean data</h2>

<p>Note: all the functions in <a href="#drop-problematic-variables-and-observations">this section</a> are rolled into <code class="highlighter-rouge">HPDataFramePlus</code> methods <code class="highlighter-rouge">encode_ords, drop_probs</code></p>

<p>Before we clean any data, we’ll store the original dataset so we have an unadulaterated copy</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create instance of HPDataFramePlus for full dataset</span>
<span class="n">orig</span> <span class="o">=</span> <span class="n">HPDataFramePlus</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">full</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="classify-variables-by-kind">Classify variables by kind</h3>

<p>Since it doesn’t affect the data, we’ll group variables in the original dataset into categorical, ordinal and quantitative kinds. We’ll use the custom class <code class="highlighter-rouge">HPDataFramePlus</code> which contains helpful methods</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># set description attribute</span>
<span class="n">orig</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>

<span class="c"># view description of all variables except sale price</span>
<span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">full</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'SalePrice'</span><span class="p">)</span>
<span class="n">orig</span><span class="o">.</span><span class="n">print_desc</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MSSubClass: Identifies the type of dwelling involved in the sale.

	 20 - 1-STORY 1946 &amp; NEWER ALL STYLES
	 30 - 1-STORY 1945 &amp; OLDER
	 40 - 1-STORY W/FINISHED ATTIC ALL AGES
	 45 - 1-1/2 STORY - UNFINISHED ALL AGES
	 50 - 1-1/2 STORY FINISHED ALL AGES
	 60 - 2-STORY 1946 &amp; NEWER
	 70 - 2-STORY 1945 &amp; OLDER
	 75 - 2-1/2 STORY ALL AGES
	 80 - SPLIT OR MULTI-LEVEL
	 85 - SPLIT FOYER
	 90 - DUPLEX - ALL STYLES AND AGES
	 120 - 1-STORY PUD (Planned Unit Development) - 1946 &amp; NEWER
	 150 - 1-1/2 STORY PUD - ALL AGES
	 160 - 2-STORY PUD - 1946 &amp; NEWER
	 180 - PUD - MULTILEVEL - INCL SPLIT LEV/FOYER
	 190 - 2 FAMILY CONVERSION - ALL STYLES AND AGES


MSZoning: Identifies the general zoning classification of the sale.

	 A - Agriculture
	 C - Commercial
	 FV - Floating Village Residential
	 I - Industrial
	 RH - Residential High Density
	 RL - Residential Low Density
	 RP - Residential Low Density Park 
	 RM - Residential Medium Density


LotFrontage: Linear feet of street connected to property



LotArea: Lot size in square feet



Street: Type of road access to property

	 Grvl - Gravel
	 Pave - Paved


Alley: Type of alley access to property

	 Grvl - Gravel
	 Pave - Paved
	 NA - No alley access


LotShape: General shape of property

	 Reg - Regular
	 IR1 - Slightly irregular
	 IR2 - Moderately Irregular
	 IR3 - Irregular


LandContour: Flatness of the property

	 Lvl - Near Flat/Level
	 Bnk - Banked - Quick and significant rise from street grade to building
	 HLS - Hillside - Significant slope from side to side
	 Low - Depression


Utilities: Type of utilities available

	 AllPub - All public Utilities (E,G,W,&amp; S)
	 NoSewr - Electricity, Gas, and Water (Septic Tank)
	 NoSeWa - Electricity and Gas Only
	 ELO - Electricity only


LotConfig: Lot configuration

	 Inside - Inside lot
	 Corner - Corner lot
	 CulDSac - Cul-de-sac
	 FR2 - Frontage on 2 sides of property
	 FR3 - Frontage on 3 sides of property


LandSlope: Slope of property

	 Gtl - Gentle slope
	 Mod - Moderate Slope
	 Sev - Severe Slope


Neighborhood: Physical locations within Ames city limits

	 Blmngtn - Bloomington Heights
	 Blueste - Bluestem
	 BrDale - Briardale
	 BrkSide - Brookside
	 ClearCr - Clear Creek
	 CollgCr - College Creek
	 Crawfor - Crawford
	 Edwards - Edwards
	 Gilbert - Gilbert
	 IDOTRR - Iowa DOT and Rail Road
	 MeadowV - Meadow Village
	 Mitchel - Mitchell
	 Names - North Ames
	 NoRidge - Northridge
	 NPkVill - Northpark Villa
	 NridgHt - Northridge Heights
	 NWAmes - Northwest Ames
	 OldTown - Old Town
	 SWISU - South &amp; West of Iowa State University
	 Sawyer - Sawyer
	 SawyerW - Sawyer West
	 Somerst - Somerset
	 StoneBr - Stone Brook
	 Timber - Timberland
	 Veenker - Veenker


Condition1: Proximity to various conditions

	 Artery - Adjacent to arterial street
	 Feedr - Adjacent to feeder street
	 Norm - Normal
	 RRNn - Within 200' of North-South Railroad
	 RRAn - Adjacent to North-South Railroad
	 PosN - Near positive off-site feature--park, greenbelt, etc.
	 PosA - Adjacent to postive off-site feature
	 RRNe - Within 200' of East-West Railroad
	 RRAe - Adjacent to East-West Railroad


Condition2: Proximity to various conditions (if more than one is present)

	 Artery - Adjacent to arterial street
	 Feedr - Adjacent to feeder street
	 Norm - Normal
	 RRNn - Within 200' of North-South Railroad
	 RRAn - Adjacent to North-South Railroad
	 PosN - Near positive off-site feature--park, greenbelt, etc.
	 PosA - Adjacent to postive off-site feature
	 RRNe - Within 200' of East-West Railroad
	 RRAe - Adjacent to East-West Railroad


BldgType: Type of dwelling

	 1Fam - Single-family Detached
	 2FmCon - Two-family Conversion; originally built as one-family dwelling
	 Duplx - Duplex
	 TwnhsE - Townhouse End Unit
	 TwnhsI - Townhouse Inside Unit


HouseStyle: Style of dwelling

	 1Story - One story
	 1.5Fin - One and one-half story: 2nd level finished
	 1.5Unf - One and one-half story: 2nd level unfinished
	 2Story - Two story
	 2.5Fin - Two and one-half story: 2nd level finished
	 2.5Unf - Two and one-half story: 2nd level unfinished
	 SFoyer - Split Foyer
	 SLvl - Split Level


OverallQual: Rates the overall material and finish of the house

	 10 - Very Excellent
	 9 - Excellent
	 8 - Very Good
	 7 - Good
	 6 - Above Average
	 5 - Average
	 4 - Below Average
	 3 - Fair
	 2 - Poor
	 1 - Very Poor


OverallCond: Rates the overall condition of the house

	 10 - Very Excellent
	 9 - Excellent
	 8 - Very Good
	 7 - Good
	 6 - Above Average
	 5 - Average
	 4 - Below Average
	 3 - Fair
	 2 - Poor
	 1 - Very Poor


YearBuilt: Original construction date



YearRemodAdd: Remodel date (same as construction date if no remodeling or additions)



RoofStyle: Type of roof

	 Flat - Flat
	 Gable - Gable
	 Gambrel - Gabrel (Barn)
	 Hip - Hip
	 Mansard - Mansard
	 Shed - Shed


RoofMatl: Roof material

	 ClyTile - Clay or Tile
	 CompShg - Standard (Composite) Shingle
	 Membran - Membrane
	 Metal - Metal
	 Roll - Roll
	 Tar&amp;Grv - Gravel &amp; Tar
	 WdShake - Wood Shakes
	 WdShngl - Wood Shingles


Exterior1st: Exterior covering on house

	 AsbShng - Asbestos Shingles
	 AsphShn - Asphalt Shingles
	 BrkComm - Brick Common
	 BrkFace - Brick Face
	 CBlock - Cinder Block
	 CemntBd - Cement Board
	 HdBoard - Hard Board
	 ImStucc - Imitation Stucco
	 MetalSd - Metal Siding
	 Other - Other
	 Plywood - Plywood
	 PreCast - PreCast
	 Stone - Stone
	 Stucco - Stucco
	 VinylSd - Vinyl Siding
	 Sdng - Wood Siding
	 WdShing - Wood Shingles


Exterior2nd: Exterior covering on house (if more than one material)

	 AsbShng - Asbestos Shingles
	 AsphShn - Asphalt Shingles
	 BrkComm - Brick Common
	 BrkFace - Brick Face
	 CBlock - Cinder Block
	 CemntBd - Cement Board
	 HdBoard - Hard Board
	 ImStucc - Imitation Stucco
	 MetalSd - Metal Siding
	 Other - Other
	 Plywood - Plywood
	 PreCast - PreCast
	 Stone - Stone
	 Stucco - Stucco
	 VinylSd - Vinyl Siding
	 Sdng - Wood Siding
	 WdShing - Wood Shingles


MasVnrType: Masonry veneer type

	 BrkCmn - Brick Common
	 BrkFace - Brick Face
	 CBlock - Cinder Block
	 None - None
	 Stone - Stone


MasVnrArea: Masonry veneer area in square feet



ExterQual: Evaluates the quality of the material on the exterior 

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 Po - Poor


ExterCond: Evaluates the present condition of the material on the exterior

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 Po - Poor


Foundation: Type of foundation

	 BrkTil - Brick &amp; Tile
	 CBlock - Cinder Block
	 PConc - Poured Contrete
	 Slab - Slab
	 Stone - Stone
	 Wood - Wood


BsmtQual: Evaluates the height of the basement

	 Ex - Excellent (100+ inches)
	 Gd - Good (90-99 inches)
	 TA - Typical (80-89 inches)
	 Fa - Fair (70-79 inches)
	 Po - Poor (&lt;70 inches
	 NA - No Basement


BsmtCond: Evaluates the general condition of the basement

	 Ex - Excellent
	 Gd - Good
	 TA - Typical - slight dampness allowed
	 Fa - Fair - dampness or some cracking or settling
	 Po - Poor - Severe cracking, settling, or wetness
	 NA - No Basement


BsmtExposure: Refers to walkout or garden level walls

	 Gd - Good Exposure
	 Av - Average Exposure (split levels or foyers typically score average or above)
	 Mn - Mimimum Exposure
	 No - No Exposure
	 NA - No Basement


BsmtFinType1: Rating of basement finished area

	 GLQ - Good Living Quarters
	 ALQ - Average Living Quarters
	 BLQ - Below Average Living Quarters
	 Rec - Average Rec Room
	 LwQ - Low Quality
	 Unf - Unfinshed
	 NA - No Basement


BsmtFinSF1: Type 1 finished square feet



BsmtFinType2: Rating of basement finished area (if multiple types)

	 GLQ - Good Living Quarters
	 ALQ - Average Living Quarters
	 BLQ - Below Average Living Quarters
	 Rec - Average Rec Room
	 LwQ - Low Quality
	 Unf - Unfinshed
	 NA - No Basement


BsmtFinSF2: Type 2 finished square feet



BsmtUnfSF: Unfinished square feet of basement area



TotalBsmtSF: Total square feet of basement area



Heating: Type of heating

	 Floor - Floor Furnace
	 GasA - Gas forced warm air furnace
	 GasW - Gas hot water or steam heat
	 Grav - Gravity furnace
	 OthW - Hot water or steam heat other than gas
	 Wall - Wall furnace


HeatingQC: Heating quality and condition

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 Po - Poor


CentralAir: Central air conditioning

	 N - No
	 Y - Yes


Electrical: Electrical system

	 SBrkr - Standard Circuit Breakers &amp; Romex
	 FuseA - Fuse Box over 60 AMP and all Romex wiring (Average)
	 FuseF - 60 AMP Fuse Box and mostly Romex wiring (Fair)
	 FuseP - 60 AMP Fuse Box and mostly knob &amp; tube wiring (poor)
	 Mix - Mixed


1stFlrSF: First Floor square feet



2ndFlrSF: Second floor square feet



LowQualFinSF: Low quality finished square feet (all floors)



GrLivArea: Above grade (ground) living area square feet



BsmtFullBath: Basement full bathrooms



BsmtHalfBath: Basement half bathrooms



FullBath: Full bathrooms above grade



HalfBath: Half baths above grade



BedroomAbvGr: Bedrooms above grade (does NOT include basement bedrooms)



KitchenAbvGr: Kitchens above grade



KitchenQual: Kitchen quality

	 Ex - Excellent
	 Gd - Good
	 TA - Typical/Average
	 Fa - Fair
	 Po - Poor


TotRmsAbvGrd: Total rooms above grade (does not include bathrooms)



Functional: Home functionality (Assume typical unless deductions are warranted)

	 Typ - Typical Functionality
	 Min1 - Minor Deductions 1
	 Min2 - Minor Deductions 2
	 Mod - Moderate Deductions
	 Maj1 - Major Deductions 1
	 Maj2 - Major Deductions 2
	 Sev - Severely Damaged
	 Sal - Salvage only


Fireplaces: Number of fireplaces



FireplaceQu: Fireplace quality

	 Ex - Excellent - Exceptional Masonry Fireplace
	 Gd - Good - Masonry Fireplace in main level
	 TA - Average - Prefabricated Fireplace in main living area or Masonry Fireplace in basement
	 Fa - Fair - Prefabricated Fireplace in basement
	 Po - Poor - Ben Franklin Stove
	 NA - No Fireplace


GarageType: Garage location

	 2Types - More than one type of garage
	 Attchd - Attached to home
	 Basment - Basement Garage
	 BuiltIn - Built-In (Garage part of house - typically has room above garage)
	 CarPort - Car Port
	 Detchd - Detached from home
	 NA - No Garage


GarageYrBlt: Year garage was built



GarageFinish: Interior finish of the garage

	 Fin - Finished
	 RFn - Rough Finished
	 Unf - Unfinished
	 NA - No Garage


GarageCars: Size of garage in car capacity



GarageArea: Size of garage in square feet



GarageQual: Garage quality

	 Ex - Excellent
	 Gd - Good
	 TA - Typical/Average
	 Fa - Fair
	 Po - Poor
	 NA - No Garage


GarageCond: Garage condition

	 Ex - Excellent
	 Gd - Good
	 TA - Typical/Average
	 Fa - Fair
	 Po - Poor
	 NA - No Garage


PavedDrive: Paved driveway

	 Y - Paved 
	 P - Partial Pavement
	 N - Dirt/Gravel


WoodDeckSF: Wood deck area in square feet



OpenPorchSF: Open porch area in square feet



EnclosedPorch: Enclosed porch area in square feet



3SsnPorch: Three season porch area in square feet



ScreenPorch: Screen porch area in square feet



PoolArea: Pool area in square feet



PoolQC: Pool quality

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 NA - No Pool


Fence: Fence quality

	 GdPrv - Good Privacy
	 MnPrv - Minimum Privacy
	 GdWo - Good Wood
	 MnWw - Minimum Wood/Wire
	 NA - No Fence


MiscFeature: Miscellaneous feature not covered in other categories

	 Elev - Elevator
	 Gar2 - 2nd Garage (if not described in garage section)
	 Othr - Other
	 Shed - Shed (over 100 SF)
	 TenC - Tennis Court
	 NA - None


MiscVal: $Value of miscellaneous feature



MoSold: Month Sold (MM)



YrSold: Year Sold (YYYY)



SaleType: Type of sale

	 WD - Warranty Deed - Conventional
	 CWD - Warranty Deed - Cash
	 VWD - Warranty Deed - VA Loan
	 New - Home just constructed and sold
	 COD - Court Officer Deed/Estate
	 Con - Contract 15% Down payment regular terms
	 ConLw - Contract Low Down payment and low interest
	 ConLI - Contract Low Interest
	 ConLD - Contract Low Down
	 Oth - Other


SaleCondition: Condition of sale

	 Normal - Normal Sale
	 Abnorml - Abnormal Sale -  trade, foreclosure, short sale
	 AdjLand - Adjoining Land Purchase
	 Alloca - Allocation - two linked properties with separate deeds, typically condo with a garage unit
	 Family - Sale between family members
	 Partial - Home was not completed when last assessed (associated with New Homes)
</code></pre></div></div>

<p>To classify the variables, there’s really no alternative here other than to carefully inspect the variable descriptions and determine which is which. To clarify our terms:</p>

<ul>
  <li>Categorical variables are discrete variables with no ordering (although they may have a numerical encoding)</li>
  <li>Ordinal variables are discrete numeric variables, hence they have an ordering (and should be numerically encoded)</li>
  <li>Quantiative variables are continuous numeric variables</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># split variables into categorical, ordinal, quantitative</span>
<span class="n">cat_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'MSSubClass'</span><span class="p">,</span> <span class="s">'MSZoning'</span><span class="p">,</span> <span class="s">'Street'</span><span class="p">,</span>
            <span class="s">'LandContour'</span><span class="p">,</span> <span class="s">'LotConfig'</span><span class="p">,</span>
            <span class="s">'Neighborhood'</span><span class="p">,</span> <span class="s">'Condition1'</span><span class="p">,</span>
            <span class="s">'Condition2'</span><span class="p">,</span> <span class="s">'BldgType'</span><span class="p">,</span> <span class="s">'HouseStyle'</span><span class="p">,</span>
            <span class="s">'RoofStyle'</span><span class="p">,</span> <span class="s">'RoofMatl'</span><span class="p">,</span>
            <span class="s">'Exterior1st'</span><span class="p">,</span> <span class="s">'Exterior2nd'</span><span class="p">,</span>
            <span class="s">'MasVnrType'</span><span class="p">,</span> <span class="s">'Foundation'</span><span class="p">,</span> <span class="s">'Heating'</span><span class="p">,</span>
            <span class="s">'CentralAir'</span><span class="p">,</span> <span class="s">'Electrical'</span><span class="p">,</span> <span class="s">'GarageType'</span><span class="p">,</span>
            <span class="s">'MiscFeature'</span><span class="p">,</span> <span class="s">'SaleType'</span><span class="p">,</span>
            <span class="s">'SaleCondition'</span><span class="p">,</span> <span class="s">'Alley'</span><span class="p">]</span>
<span class="n">ord_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'LotShape'</span><span class="p">,</span> <span class="s">'Utilities'</span><span class="p">,</span> <span class="s">'LandSlope'</span><span class="p">,</span> <span class="s">'OverallQual'</span><span class="p">,</span> <span class="s">'OverallCond'</span><span class="p">,</span> <span class="s">'ExterQual'</span><span class="p">,</span> 
            <span class="s">'ExterCond'</span><span class="p">,</span> <span class="s">'BsmtQual'</span><span class="p">,</span> <span class="s">'BsmtCond'</span><span class="p">,</span> <span class="s">'BsmtExposure'</span><span class="p">,</span> <span class="s">'BsmtFinType1'</span><span class="p">,</span> <span class="s">'BsmtFinType2'</span><span class="p">,</span>
            <span class="s">'HeatingQC'</span><span class="p">,</span> <span class="s">'BsmtFullBath'</span><span class="p">,</span> <span class="s">'BsmtHalfBath'</span><span class="p">,</span> <span class="s">'FullBath'</span><span class="p">,</span> <span class="s">'HalfBath'</span><span class="p">,</span> <span class="s">'BedroomAbvGr'</span><span class="p">,</span> 
            <span class="s">'KitchenAbvGr'</span><span class="p">,</span> <span class="s">'KitchenQual'</span><span class="p">,</span> <span class="s">'TotRmsAbvGrd'</span><span class="p">,</span> <span class="s">'Functional'</span><span class="p">,</span> <span class="s">'Fireplaces'</span><span class="p">,</span> <span class="s">'FireplaceQu'</span><span class="p">,</span>
            <span class="s">'GarageFinish'</span><span class="p">,</span> <span class="s">'GarageCars'</span><span class="p">,</span> <span class="s">'GarageQual'</span><span class="p">,</span> <span class="s">'GarageCond'</span><span class="p">,</span> <span class="s">'PavedDrive'</span><span class="p">,</span> <span class="s">'PoolQC'</span><span class="p">,</span> <span class="s">'Fence'</span><span class="p">,</span>
            <span class="s">'MoSold'</span><span class="p">,</span> <span class="s">'YrSold'</span><span class="p">]</span>
<span class="n">quant_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'LotFrontage'</span><span class="p">,</span> <span class="s">'LotArea'</span><span class="p">,</span> <span class="s">'YearBuilt'</span><span class="p">,</span> <span class="s">'YearRemodAdd'</span><span class="p">,</span> <span class="s">'MasVnrArea'</span><span class="p">,</span> <span class="s">'BsmtFinSF1'</span><span class="p">,</span> 
              <span class="s">'BsmtFinSF2'</span><span class="p">,</span> <span class="s">'BsmtUnfSF'</span><span class="p">,</span> <span class="s">'TotalBsmtSF'</span><span class="p">,</span> <span class="s">'1stFlrSF'</span><span class="p">,</span> <span class="s">'2ndFlrSF'</span><span class="p">,</span> <span class="s">'LowQualFinSF'</span><span class="p">,</span> 
              <span class="s">'GrLivArea'</span><span class="p">,</span> <span class="s">'GarageYrBlt'</span><span class="p">,</span> <span class="s">'GarageArea'</span><span class="p">,</span> <span class="s">'WoodDeckSF'</span><span class="p">,</span> <span class="s">'OpenPorchSF'</span><span class="p">,</span> 
              <span class="s">'EnclosedPorch'</span><span class="p">,</span> <span class="s">'3SsnPorch'</span><span class="p">,</span> <span class="s">'ScreenPorch'</span><span class="p">,</span> <span class="s">'PoolArea'</span><span class="p">,</span> <span class="s">'MiscVal'</span><span class="p">,</span>
              <span class="s">'SalePrice'</span><span class="p">]</span>

<span class="c"># group columns by kind</span>
<span class="n">col_kinds</span> <span class="o">=</span> <span class="p">{</span><span class="s">'cat'</span><span class="p">:</span> <span class="n">cat_cols</span><span class="p">,</span> <span class="s">'ord'</span><span class="p">:</span> <span class="n">ord_cols</span><span class="p">,</span> <span class="s">'quant'</span><span class="p">:</span> <span class="n">quant_cols</span><span class="p">}</span>

<span class="c"># set col_kinds attribute</span>
<span class="n">orig</span><span class="o">.</span><span class="n">col_kinds</span> <span class="o">=</span> <span class="n">col_kinds</span>
</code></pre></div></div>

<p>Now the cleaning begins.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create new dataframe for cleaned data and set attributes</span>
<span class="n">clean</span> <span class="o">=</span> <span class="n">HPDataFramePlus</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">full</span><span class="p">)</span>
<span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">col_kinds</span>
<span class="n">clean</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">desc</span>
</code></pre></div></div>

<h3 id="encode-variables">Encode variables</h3>

<p>Before we can clean, we need to make sure all variables are encoded appropriately. Let’s compare the dtypes of our dataframe with the variable types</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dtypes for categorical variables</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">[</span><span class="s">'cat'</span><span class="p">]]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 2919 entries, (train, 1) to (test, 2919)
Data columns (total 24 columns):
MSSubClass       2919 non-null int64
MSZoning         2915 non-null object
Street           2919 non-null object
LandContour      2919 non-null object
LotConfig        2919 non-null object
Neighborhood     2919 non-null object
Condition1       2919 non-null object
Condition2       2919 non-null object
BldgType         2919 non-null object
HouseStyle       2919 non-null object
RoofStyle        2919 non-null object
RoofMatl         2919 non-null object
Exterior1st      2918 non-null object
Exterior2nd      2918 non-null object
MasVnrType       2895 non-null object
Foundation       2919 non-null object
Heating          2919 non-null object
CentralAir       2919 non-null object
Electrical       2918 non-null object
GarageType       2762 non-null object
MiscFeature      105 non-null object
SaleType         2918 non-null object
SaleCondition    2919 non-null object
Alley            198 non-null object
dtypes: int64(1), object(23)
memory usage: 578.8+ KB
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dtypes for ordinal variables</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">[</span><span class="s">'ord'</span><span class="p">]]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 2919 entries, (train, 1) to (test, 2919)
Data columns (total 33 columns):
LotShape        2919 non-null object
Utilities       2917 non-null object
LandSlope       2919 non-null object
OverallQual     2919 non-null int64
OverallCond     2919 non-null int64
ExterQual       2919 non-null object
ExterCond       2919 non-null object
BsmtQual        2838 non-null object
BsmtCond        2837 non-null object
BsmtExposure    2837 non-null object
BsmtFinType1    2840 non-null object
BsmtFinType2    2839 non-null object
HeatingQC       2919 non-null object
BsmtFullBath    2917 non-null float64
BsmtHalfBath    2917 non-null float64
FullBath        2919 non-null int64
HalfBath        2919 non-null int64
BedroomAbvGr    2919 non-null int64
KitchenAbvGr    2919 non-null int64
KitchenQual     2918 non-null object
TotRmsAbvGrd    2919 non-null int64
Functional      2917 non-null object
Fireplaces      2919 non-null int64
FireplaceQu     1499 non-null object
GarageFinish    2760 non-null object
GarageCars      2918 non-null float64
GarageQual      2760 non-null object
GarageCond      2760 non-null object
PavedDrive      2919 non-null object
PoolQC          10 non-null object
Fence           571 non-null object
MoSold          2919 non-null int64
YrSold          2919 non-null int64
dtypes: float64(3), int64(10), object(20)
memory usage: 784.1+ KB
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># dtypes for quantitative variables</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">[</span><span class="s">'quant'</span><span class="p">]]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 2919 entries, (train, 1) to (test, 2919)
Data columns (total 23 columns):
LotFrontage      2433 non-null float64
LotArea          2919 non-null int64
YearBuilt        2919 non-null int64
YearRemodAdd     2919 non-null int64
MasVnrArea       2896 non-null float64
BsmtFinSF1       2918 non-null float64
BsmtFinSF2       2918 non-null float64
BsmtUnfSF        2918 non-null float64
TotalBsmtSF      2918 non-null float64
1stFlrSF         2919 non-null int64
2ndFlrSF         2919 non-null int64
LowQualFinSF     2919 non-null int64
GrLivArea        2919 non-null int64
GarageYrBlt      2760 non-null float64
GarageArea       2918 non-null float64
WoodDeckSF       2919 non-null int64
OpenPorchSF      2919 non-null int64
EnclosedPorch    2919 non-null int64
3SsnPorch        2919 non-null int64
ScreenPorch      2919 non-null int64
PoolArea         2919 non-null int64
MiscVal          2919 non-null int64
SalePrice        1460 non-null float64
dtypes: float64(9), int64(14)
memory usage: 556.0+ KB
</code></pre></div></div>

<p>Categorical and quantitative dtypes look good, but we’ll need to deal with the ordinal variables.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># inspect description of ordinal variables</span>
<span class="n">clean</span><span class="o">.</span><span class="n">print_desc</span><span class="p">(</span><span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">[</span><span class="s">'ord'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LotShape: General shape of property

	 Reg - Regular
	 IR1 - Slightly irregular
	 IR2 - Moderately Irregular
	 IR3 - Irregular


Utilities: Type of utilities available

	 AllPub - All public Utilities (E,G,W,&amp; S)
	 NoSewr - Electricity, Gas, and Water (Septic Tank)
	 NoSeWa - Electricity and Gas Only
	 ELO - Electricity only


LandSlope: Slope of property

	 Gtl - Gentle slope
	 Mod - Moderate Slope
	 Sev - Severe Slope


OverallQual: Rates the overall material and finish of the house

	 10 - Very Excellent
	 9 - Excellent
	 8 - Very Good
	 7 - Good
	 6 - Above Average
	 5 - Average
	 4 - Below Average
	 3 - Fair
	 2 - Poor
	 1 - Very Poor


OverallCond: Rates the overall condition of the house

	 10 - Very Excellent
	 9 - Excellent
	 8 - Very Good
	 7 - Good
	 6 - Above Average
	 5 - Average
	 4 - Below Average
	 3 - Fair
	 2 - Poor
	 1 - Very Poor


ExterQual: Evaluates the quality of the material on the exterior 

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 Po - Poor


ExterCond: Evaluates the present condition of the material on the exterior

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 Po - Poor


BsmtQual: Evaluates the height of the basement

	 Ex - Excellent (100+ inches)
	 Gd - Good (90-99 inches)
	 TA - Typical (80-89 inches)
	 Fa - Fair (70-79 inches)
	 Po - Poor (&lt;70 inches
	 NA - No Basement


BsmtCond: Evaluates the general condition of the basement

	 Ex - Excellent
	 Gd - Good
	 TA - Typical - slight dampness allowed
	 Fa - Fair - dampness or some cracking or settling
	 Po - Poor - Severe cracking, settling, or wetness
	 NA - No Basement


BsmtExposure: Refers to walkout or garden level walls

	 Gd - Good Exposure
	 Av - Average Exposure (split levels or foyers typically score average or above)
	 Mn - Mimimum Exposure
	 No - No Exposure
	 NA - No Basement


BsmtFinType1: Rating of basement finished area

	 GLQ - Good Living Quarters
	 ALQ - Average Living Quarters
	 BLQ - Below Average Living Quarters
	 Rec - Average Rec Room
	 LwQ - Low Quality
	 Unf - Unfinshed
	 NA - No Basement


BsmtFinType2: Rating of basement finished area (if multiple types)

	 GLQ - Good Living Quarters
	 ALQ - Average Living Quarters
	 BLQ - Below Average Living Quarters
	 Rec - Average Rec Room
	 LwQ - Low Quality
	 Unf - Unfinshed
	 NA - No Basement


HeatingQC: Heating quality and condition

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 Po - Poor


BsmtFullBath: Basement full bathrooms



BsmtHalfBath: Basement half bathrooms



FullBath: Full bathrooms above grade



HalfBath: Half baths above grade



BedroomAbvGr: Bedrooms above grade (does NOT include basement bedrooms)



KitchenAbvGr: Kitchens above grade



KitchenQual: Kitchen quality

	 Ex - Excellent
	 Gd - Good
	 TA - Typical/Average
	 Fa - Fair
	 Po - Poor


TotRmsAbvGrd: Total rooms above grade (does not include bathrooms)



Functional: Home functionality (Assume typical unless deductions are warranted)

	 Typ - Typical Functionality
	 Min1 - Minor Deductions 1
	 Min2 - Minor Deductions 2
	 Mod - Moderate Deductions
	 Maj1 - Major Deductions 1
	 Maj2 - Major Deductions 2
	 Sev - Severely Damaged
	 Sal - Salvage only


Fireplaces: Number of fireplaces



FireplaceQu: Fireplace quality

	 Ex - Excellent - Exceptional Masonry Fireplace
	 Gd - Good - Masonry Fireplace in main level
	 TA - Average - Prefabricated Fireplace in main living area or Masonry Fireplace in basement
	 Fa - Fair - Prefabricated Fireplace in basement
	 Po - Poor - Ben Franklin Stove
	 NA - No Fireplace


GarageFinish: Interior finish of the garage

	 Fin - Finished
	 RFn - Rough Finished
	 Unf - Unfinished
	 NA - No Garage


GarageCars: Size of garage in car capacity



GarageQual: Garage quality

	 Ex - Excellent
	 Gd - Good
	 TA - Typical/Average
	 Fa - Fair
	 Po - Poor
	 NA - No Garage


GarageCond: Garage condition

	 Ex - Excellent
	 Gd - Good
	 TA - Typical/Average
	 Fa - Fair
	 Po - Poor
	 NA - No Garage


PavedDrive: Paved driveway

	 Y - Paved 
	 P - Partial Pavement
	 N - Dirt/Gravel


PoolQC: Pool quality

	 Ex - Excellent
	 Gd - Good
	 TA - Average/Typical
	 Fa - Fair
	 NA - No Pool


Fence: Fence quality

	 GdPrv - Good Privacy
	 MnPrv - Minimum Privacy
	 GdWo - Good Wood
	 MnWw - Minimum Wood/Wire
	 NA - No Fence


MoSold: Month Sold (MM)



YrSold: Year Sold (YYYY)
</code></pre></div></div>

<p>Upon careful reflection, we’ll encode the ordinal variable values by hand (taking care to distinguish between values of 0 and truly missing values)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># encode ordinal variable values in dictionary by hand when needed</span>
<span class="n">ords</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'GarageCond'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Po'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'Fa'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'TA'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'Gd'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'Ex'</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'BsmtCond'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'GarageCond'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'BsmtCond'</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">'Ex'</span><span class="p">)</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'LandSlope'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Gtl'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Mod'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'Sev'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'PavedDrive'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'N'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'P'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'Y'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'GarageFinish'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nan</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Unf'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'RFn'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'Fin'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'BsmtQual'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nan</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Fa'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'TA'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'Gd'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'Ex'</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'GarageQual'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'GarageCond'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'LotShape'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Reg'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'IR1'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'IR2'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'IR3'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'Functional'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="ow">in</span>
                      <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span>
                        <span class="n">orig</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">'Functional'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'Functional'</span><span class="p">][</span><span class="n">nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">nan</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'ExterCond'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'GarageCond'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'ExterQual'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Fa'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'TA'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'Gd'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'Ex'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'HeatingQC'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'GarageCond'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'KitchenQual'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'BsmtQual'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'BsmtFinType1'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nan</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Unf'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'LwQ'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'Rec'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'BLQ'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                        <span class="s">'ALQ'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">'GLQ'</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'BsmtFinType2'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'BsmtFinType1'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'BsmtExposure'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nan</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'No'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'Mn'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'Av'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'Gd'</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'Fence'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nan</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'MnPrv'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'MnWw'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'GdWo'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'GdPrv'</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'FireplaceQu'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'GarageCond'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'PoolQC'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ords</span><span class="p">[</span><span class="s">'BsmtQual'</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ords</span><span class="p">[</span><span class="s">'Utilities'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">nan</span><span class="p">:</span> <span class="n">nan</span><span class="p">,</span> <span class="s">'ELO'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'NoSeWa'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'NoSewr'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'AllPub'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="c"># perform encoding</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">encode_ords</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="n">ords</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="drop-problematic-variables-and-observations">Drop problematic variables and observations</h3>

<p>Now that all variables are properly encoded, we can drop those with too many missing values immediately. We’ll be somewhat conservative and drop variables missing  <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>&gt;</mo><mn>20</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">&gt;20\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.80556em;vertical-align:-0.05556em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">%</span></span></span></span>  of values</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># create a new dataframe for cleaning</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">drop_mostly_missing_cols</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
<span class="n">clean</span><span class="o">.</span><span class="n">update_col_kinds</span><span class="p">(</span><span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">)</span>
</code></pre></div></div>

<p>We’ll also drop some well-known outlying observations (at least, well-known on Kaggle ) in the training data. Dropping outliers is (for good reason) very controversial, and one should take great care in doing so. The justification for it depends on context, however. In our case, the end goal is to predict <code class="highlighter-rouge">SalePrice</code> accuractely. If dropping outliers improves the ability of our prediction model to generalize, than this may provide some retroactive justification.</p>

<p>First we’ll plot the outliers (identifying them by their relationship to <code class="highlighter-rouge">SalePrice</code>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># plot variables which contain well-known outliers</span>
<span class="n">plot_outliers</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/ames_house_prices/assets/images/process_42_0.png" alt="png" /></p>

<p>Kagglers seem to frequently conclude that the outliers are the house with overall quality 4 but a sale price of more than \$250,000, and the two houses with more than 4500 sq ft of general living area but sale prices less than \$300,000.</p>

<p>Whether this is well-justified, and how much it’s an example of groupthink, is a matter for debate. But it seems to regularly improve the predictive capability of models, so we’ll follow suit.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># drop well-known outliers</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">drop_outliers</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
<span class="n">clean</span><span class="o">.</span><span class="n">update_col_kinds</span><span class="p">(</span><span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="missing-values">Missing Values</h3>

<p>Our dataset is missing a lot of values!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># counts of missing values by variable, excluding SalePrice</span>
<span class="n">clean</span><span class="o">.</span><span class="n">na_counts</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'SalePrice'</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MSZoning          4
LotFrontage     485
Utilities         2
Exterior1st       1
Exterior2nd       1
MasVnrType       24
MasVnrArea       23
BsmtFinSF1        1
BsmtFinSF2        1
BsmtUnfSF         1
TotalBsmtSF       1
Electrical        1
BsmtFullBath      2
BsmtHalfBath      2
Functional        2
GarageType      157
GarageYrBlt     159
GarageCars        1
GarageArea        1
SaleType          1
dtype: int64
</code></pre></div></div>

<h4 id="inspect-train-and-test-distributions-of-missing-values">Inspect train and test distributions of missing values</h4>

<p>Before we get into imputing them, to inform our choice of methods, let’s see how their distributions might differ across training and test sets. We want to be careful imputing missing values when those missing values are distributed unevenly across train and test sets if our goal is prediction, since our imputation could introduce further difference between train and test sets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># plot distributions of missing values in train and test sets</span>
<span class="n">plot_train_and_test_missing_values</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/ames_house_prices/assets/images/process_52_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># variables missing values in train but not test set</span>
<span class="n">train_missing</span> <span class="o">=</span> <span class="n">HPDataFramePlus</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'train'</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">na_counts</span><span class="p">()</span>
<span class="n">test_missing</span> <span class="o">=</span> <span class="n">HPDataFramePlus</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s">'test'</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">na_counts</span><span class="p">()</span>
<span class="n">train_not_test</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">train_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">test_missing</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">train_not_test</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['Electrical']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># variables missing values in test but not train set</span>
<span class="n">test_not_train</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">test_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">train_missing</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">test_not_train</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['GarageArea',
 'Exterior2nd',
 'BsmtHalfBath',
 'BsmtUnfSF',
 'BsmtFinSF2',
 'BsmtFinSF1',
 'Functional',
 'Utilities',
 'GarageCars',
 'TotalBsmtSF',
 'SaleType',
 'BsmtFullBath',
 'MSZoning',
 'Exterior1st',
 'SalePrice']
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># count of variables missing values in train but not test set</span>
<span class="n">train_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_not_test</span><span class="p">]</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Electrical    1
dtype: int64
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># count of variables missing values in test but not train</span>
<span class="n">test_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_not_train</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GarageArea      1
Exterior2nd     1
BsmtHalfBath    2
BsmtUnfSF       1
BsmtFinSF2      1
BsmtFinSF1      1
Functional      2
Utilities       2
GarageCars      1
TotalBsmtSF     1
SaleType        1
BsmtFullBath    2
MSZoning        4
Exterior1st     1
dtype: int64
</code></pre></div></div>

<p>Since there are so few missing values for variables which are missing values in the train set not the test set (or vice versa), we won’t worry about imputing them.</p>

<p>Now let’s look at the distributions of variables missing in both train and test sets</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Plot distributions variables missing both train and test values.</span>
<span class="n">plot_both_train_and_test_missing_values</span><span class="p">(</span><span class="n">clean</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/ames_house_prices/assets/images/process_58_0.png" alt="png" /></p>

<p>For variables missing values in both sets, the distributions are very similar, so we’ll go ahead and impute these values</p>

<h4 id="impute-small-numbers-of-missing-values-by-hand">Impute small numbers of missing values by hand</h4>

<p>Imputation of missing values using point estimates (mean, mode, etc.) is very common but arguable somewhat crude. Since there are more sophisticated methods which aren’t too difficult to use, we’d like to use them. They are however, a bit more computationally expensive. Since many of our variables are only missing a few values, imputing these values by hand using point estimates will cut down on computational cost while sacrificing little.</p>

<p>An excellent, thorough treatment of imputation can be found in <a href="https://stefvanbuuren.name/fimd/">Flexible Imputation of Missing Data</a> by Stef Van Buren.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Impute variables with &lt;= 4 missing values. Use mode for categoricals, median for quantitatives</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">hand_impute</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># missing value counts again</span>
<span class="n">clean</span><span class="o">.</span><span class="n">na_counts</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LotFrontage    485
MasVnrType      24
MasVnrArea      23
GarageType     157
GarageYrBlt    159
dtype: int64
</code></pre></div></div>

<h4 id="impute-missing-categorical-values-with-xgbclassifier">Impute missing categorical values with <code class="highlighter-rouge">XGBClassifier</code></h4>

<p>Some methods for imputing missing categorical data are more common, e.g. multinomial classification, but any classifier will do. Given time and the inclination, one could explore different classifiers and try to estimate their imputation accuracy (e.g. by cross-validation on data with no missing values) but we won’t do that here. Since <code class="highlighter-rouge">xgboost</code> classifier often performs very well with defaults, we’ll use it to impute <code class="highlighter-rouge">MasVnrType</code> and <code class="highlighter-rouge">GarageType</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># impute missing categorical values with XGBClassifier</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">impute_cats</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="s">'SalePrice'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># missing value counts again</span>
<span class="n">clean</span><span class="o">.</span><span class="n">na_counts</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LotFrontage    485
MasVnrArea      23
GarageYrBlt    159
dtype: int64
</code></pre></div></div>

<h4 id="impute-missing-quantitative-values-with-mice-and-pmm">Impute missing quantitative values with MICE and PMM</h4>

<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/">Multiple Imputation with Chained Equations (MICE)</a> is principled method of imputing missing data. It can be combined with <a href="http://stefvanbuuren.name/fimd/sec-pmm.html">Predictive Mean Matching (PMM)</a> to yield a powerful implementation method. One can find these methods implemented in Python in <code class="highlighter-rouge">statsmodels.imputation.mice</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># impute missing quantitative values with MICE and PMM</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">impute_quants</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="s">'SalePrice'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># missing value counts again</span>
<span class="n">clean</span><span class="o">.</span><span class="n">na_counts</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s">'SalePrice'</span><span class="p">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Series([], dtype: int64)
</code></pre></div></div>

<h3 id="enforce-dtypes">Enforce dtypes</h3>

<p>On top of our <code class="highlighter-rouge">col_kinds</code> dictionary, we’ll use pandas dtypes to track categorical, ordinal, and quantitative variables</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cats</span><span class="p">,</span> <span class="n">ords</span><span class="p">,</span> <span class="n">quants</span> <span class="o">=</span> <span class="p">(</span><span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">[</span><span class="s">'cat'</span><span class="p">],</span> <span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">[</span><span class="s">'ord'</span><span class="p">],</span>
                          <span class="n">clean</span><span class="o">.</span><span class="n">col_kinds</span><span class="p">[</span><span class="s">'quant'</span><span class="p">])</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cats</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">cats</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'category'</span><span class="p">)</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">ords</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">ords</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'int64'</span><span class="p">)</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'MSSubClass'</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">'MSSubClass'</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                                      <span class="s">'category'</span><span class="p">)</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">quants</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">quants</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'float64'</span><span class="p">)</span>
<span class="n">clean</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
MultiIndex: 2917 entries, (train, 1) to (test, 2919)
Data columns (total 78 columns):
MSSubClass       2917 non-null category
MSZoning         2917 non-null category
LotFrontage      2917 non-null float64
LotArea          2917 non-null float64
Street           2917 non-null category
LotShape         2917 non-null int64
LandContour      2917 non-null category
Utilities        2917 non-null int64
LotConfig        2917 non-null category
LandSlope        2917 non-null int64
Neighborhood     2917 non-null category
Condition1       2917 non-null category
Condition2       2917 non-null category
BldgType         2917 non-null category
HouseStyle       2917 non-null category
OverallQual      2917 non-null int64
OverallCond      2917 non-null int64
YearBuilt        2917 non-null float64
YearRemodAdd     2917 non-null float64
RoofStyle        2917 non-null category
RoofMatl         2917 non-null category
Exterior1st      2917 non-null category
Exterior2nd      2917 non-null category
MasVnrType       2917 non-null category
MasVnrArea       2917 non-null float64
ExterQual        2917 non-null int64
ExterCond        2917 non-null int64
Foundation       2917 non-null category
BsmtQual         2917 non-null int64
BsmtCond         2917 non-null int64
BsmtExposure     2917 non-null int64
BsmtFinType1     2917 non-null int64
BsmtFinSF1       2917 non-null float64
BsmtFinType2     2917 non-null int64
BsmtFinSF2       2917 non-null float64
BsmtUnfSF        2917 non-null float64
TotalBsmtSF      2917 non-null float64
Heating          2917 non-null category
HeatingQC        2917 non-null int64
CentralAir       2917 non-null category
Electrical       2917 non-null category
1stFlrSF         2917 non-null float64
2ndFlrSF         2917 non-null float64
LowQualFinSF     2917 non-null float64
GrLivArea        2917 non-null float64
BsmtFullBath     2917 non-null int64
BsmtHalfBath     2917 non-null int64
FullBath         2917 non-null int64
HalfBath         2917 non-null int64
BedroomAbvGr     2917 non-null int64
KitchenAbvGr     2917 non-null int64
KitchenQual      2917 non-null int64
TotRmsAbvGrd     2917 non-null int64
Functional       2917 non-null int64
Fireplaces       2917 non-null int64
FireplaceQu      2917 non-null int64
GarageType       2917 non-null category
GarageYrBlt      2917 non-null float64
GarageFinish     2917 non-null int64
GarageCars       2917 non-null int64
GarageArea       2917 non-null float64
GarageQual       2917 non-null int64
GarageCond       2917 non-null int64
PavedDrive       2917 non-null int64
WoodDeckSF       2917 non-null float64
OpenPorchSF      2917 non-null float64
EnclosedPorch    2917 non-null float64
3SsnPorch        2917 non-null float64
ScreenPorch      2917 non-null float64
PoolArea         2917 non-null float64
PoolQC           2917 non-null int64
Fence            2917 non-null int64
MiscVal          2917 non-null float64
MoSold           2917 non-null int64
YrSold           2917 non-null int64
SaleType         2917 non-null category
SaleCondition    2917 non-null category
SalePrice        1458 non-null float64
dtypes: category(22), float64(23), int64(33)
memory usage: 1.4+ MB
</code></pre></div></div>

<h2 id="save-processed-data">Save processed data</h2>

<p>Finally we’ll save our datasets to disk. This will result in two files</p>

<ul>
  <li><code class="highlighter-rouge">orig.csv</code> - Original train and test data combined in a single dataset, without any modification</li>
  <li><code class="highlighter-rouge">clean.csv</code> - Cleaned dataset, with problematic variables and observations dropped and missing values imputed</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hp_data</span> <span class="o">=</span> <span class="n">DataPlus</span><span class="p">({</span><span class="s">'orig'</span><span class="p">:</span> <span class="n">orig</span><span class="p">,</span> <span class="s">'clean'</span><span class="p">:</span> <span class="n">clean</span><span class="p">})</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="s">'../data'</span>
<span class="n">hp_data</span><span class="o">.</span><span class="n">save_dfs</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">)</span>
</code></pre></div></div>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', functione. {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
